{
  "$schema": "http://json-schema.org/draft/2020-12/schema",
  "$id": "https://atp.dev/schema/v0.1/agent-manifest.json",
  "title": "ATP Agent Manifest",
  "description": "JSON Schema for validating Agent Transfer Protocol manifests (v0.1)",
  "type": "object",
  "required": ["@context", "@type", "name", "description", "version", "capabilities"],
  "properties": {
    "@context": {
      "type": "string",
      "const": "https://atp.dev/schema/v1",
      "description": "JSON-LD context URI for ATP"
    },
    "@type": {
      "type": "string",
      "const": "AgentManifest",
      "description": "Document type identifier"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "Human-readable name of the service"
    },
    "description": {
      "type": "string",
      "minLength": 1,
      "maxLength": 2000,
      "description": "Natural language description of the service for LLM reasoning"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+",
      "description": "Semantic version of this manifest"
    },
    "provider": {
      "type": "object",
      "required": ["name", "url"],
      "properties": {
        "name": { "type": "string" },
        "url": { "type": "string", "format": "uri" },
        "contact": { "type": "string", "format": "email" },
        "logo": { "type": "string", "format": "uri" }
      }
    },
    "auth": {
      "type": "object",
      "properties": {
        "schemes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["oauth2", "apiKey", "bearer", "delegated"]
              }
            }
          }
        },
        "agentIdentity": {
          "type": "object",
          "properties": {
            "required": { "type": "boolean" },
            "format": {
              "type": "string",
              "enum": ["did:web", "did:key", "custom"]
            }
          }
        }
      }
    },
    "rateLimit": {
      "type": "object",
      "properties": {
        "requests": { "type": "integer", "minimum": 1 },
        "window": { "type": "string", "pattern": "^\\d+[smhd]$" },
        "burstLimit": { "type": "integer", "minimum": 1 },
        "tierUrl": { "type": "string", "format": "uri" }
      }
    },
    "capabilities": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "name", "description", "endpoint", "method"],
        "properties": {
          "id": { "type": "string", "pattern": "^[a-z0-9-]+$" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "semanticType": { "type": "string", "pattern": "^[a-z]+:[a-z0-9-]+$" },
          "endpoint": { "type": "string" },
          "method": { "type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"] },
          "parameters": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "type"],
              "properties": {
                "name": { "type": "string" },
                "type": { "type": "string", "enum": ["string", "number", "integer", "boolean", "array", "object"] },
                "required": { "type": "boolean", "default": false },
                "description": { "type": "string" },
                "default": {},
                "enum": { "type": "array" },
                "format": { "type": "string" },
                "minimum": { "type": "number" },
                "maximum": { "type": "number" },
                "pattern": { "type": "string" }
              }
            }
          },
          "response": { "type": "object" },
          "requiredScopes": { "type": "array", "items": { "type": "string" } },
          "sideEffects": { "type": "boolean", "default": false },
          "confirmation": {
            "type": "object",
            "properties": {
              "required": { "type": "boolean" },
              "message": { "type": "string" }
            }
          },
          "deprecated": { "type": "boolean", "default": false },
          "deprecationMessage": { "type": "string" }
        }
      }
    },
    "workflows": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "name", "description", "steps"],
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "steps": { "type": "array", "items": { "type": "string" } },
          "conditional": { "type": "object" }
        }
      }
    },
    "schemas": {
      "type": "object",
      "additionalProperties": { "type": "object" }
    },
    "policies": {
      "type": "object",
      "properties": {
        "training": { "type": "string", "enum": ["allow", "deny", "conditional"] },
        "inference": { "type": "string", "enum": ["allow", "deny", "conditional"] },
        "caching": {
          "type": "object",
          "properties": {
            "allowed": { "type": "boolean" },
            "maxAge": { "type": "integer", "minimum": 0 }
          }
        },
        "attribution": { "type": "string", "enum": ["required", "preferred", "none"] },
        "termsUrl": { "type": "string", "format": "uri" },
        "privacyUrl": { "type": "string", "format": "uri" }
      }
    }
  }
}
